<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Interactive DPoP</title>
<meta content="Nathanael Ritz" name="author">
<meta content="
       This document describes IDPoP, an extension to DPoP   that uses a key derivation scheme to separate access control from identity. It mitigates credential exfiltration risks by requiring fresh hardware attestation to unseal identity keys via an interactive challenge. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="OAuth" name="keyword">
<meta content="DPoP" name="keyword">
<meta content="RATS" name="keyword">
<meta content="HPKE" name="keyword">
<meta content="draft-ritz-idpop-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.12.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.2.1
    Jinja2 3.1.6
    lxml 6.0.2
    platformdirs 4.5.1
    pycountry 24.6.1
    PyYAML 6.0.3
    requests 2.32.5
    wcwidth 0.3.0
-->
<link href="draft-ritz-idpop.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
  border-left: 2px var(--pilcrow-strong) solid;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow, a.pilcrow:focus {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">IDPoP</td>
<td class="right">February 2026</td>
</tr></thead>
<tfoot><tr>
<td class="left">Ritz</td>
<td class="center">Expires 5 August 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ritz-idpop-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2026-02-01" class="published">1 February 2026</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-08-05">5 August 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">N. Ritz</div>
<div class="org">Independent</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Interactive DPoP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes IDPoP, an extension to DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span> that uses a key derivation scheme to separate access control from identity. It mitigates credential exfiltration risks by requiring fresh hardware attestation to unseal identity keys via an interactive challenge.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 August 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2026 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-three-factor-interface-mode" class="internal xref">Three-Factor Interface Model</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-algorithms" class="internal xref">Algorithms</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-algorithm-1-derivekem-clien" class="internal xref">Algorithm 1: DeriveKEM (Client)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1" class="keepWithNext"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-algorithm-2-encapsulatesecr" class="internal xref">Algorithm 2: EncapsulateSecret (AS-A)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.  <a href="#name-algorithm-3-deriveidentity-" class="internal xref">Algorithm 3: DeriveIdentity (Client)</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-oauth-identity-chaining-flo" class="internal xref">OAuth Identity Chaining Flow</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-interactive-challenge-proof" class="internal xref">Interactive Challenge &amp; Proofs</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-properties" class="internal xref">Security Properties</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-authorization-server-as-roo" class="internal xref">Authorization Server as Root of Trust</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-encapsulated-secret-transpo" class="internal xref">Encapsulated Secret Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-harvest-now-decrypt-later-a" class="internal xref">"Harvest Now, Decrypt Later" and Forward Secrecy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3.2.1">
                    <p id="section-toc.1-1.7.2.3.2.1.1"><a href="#section-7.3.1" class="auto internal xref">7.3.1</a>.  <a href="#name-post-quantum-agility" class="internal xref">Post-Quantum Agility</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-dpop-proof-replay-and-pre-c" class="internal xref">DPoP Proof Replay and Pre-Computation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Standard DPoP binds tokens to keys but recent events have increased risks to exfiltration attacks where autonomous systems (such as agentic AI) leak valid credentials via prompt injection. Likewise, when malware compromises a device filesystem, attackers steal credentials and impersonate users until explicit revocation.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This proposal introduces a derivation scheme separating <strong>access control</strong> (encapsulate/decapsulate) from <strong>identity</strong> (signing).<a href="#section-1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="three-factor-interface-model">
<section id="section-2">
      <h2 id="name-three-factor-interface-mode">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-three-factor-interface-mode" class="section-name selfRef">Three-Factor Interface Model</a>
      </h2>
<p id="section-2-1"><strong>Factors:</strong><a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1"><strong>PF (Provisioning Factor):</strong> Represents authorization intent (<code>client_id</code> + scope + audience).<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1"><strong>EF (Evidence Factor):</strong> Confidential attestation proof (TPM quote, YubiKey HMAC-secret, biometric), never transmitted.<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.3">
          <p id="section-2-2.3.1"><strong>VF (Vault Factor):</strong> High-entropy secret, encapsulated by Evidence derived key.<a href="#section-2-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-3"><strong>Two-Stage Derivation:</strong><a href="#section-2-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-4">
<li id="section-2-4.1">
          <p id="section-2-4.1.1">Access gating: <code>K_kem = HKDF(salt=PF, ikm=EF, info="seal")</code><a href="#section-2-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-4.2">
          <p id="section-2-4.2.1">Identity derivation: <code>K_attest = HKDF(salt=PF, ikm=VF, info="dpop")</code><a href="#section-2-4.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div class="alignLeft art-text artwork" id="section-2-5">
<pre>
        .-------------------.
        | AS-A (Verifier)   | 2. AS-A (RATS Verifier)
        | RATS Notary as    |    Appraises Evidence
        | OAuth AS          |    Derive K_kem, K_dpop
        '----+----+---------'    Seal id seed → VF_sealed
             ^    |
1. Evidence  |    | 3. Attestation Result (AR)
   conveyed  |    |    as JWT OAuth grant with:
   (as commitment)|    - requested_cnf {jkt, K_kem_pub}
             |    |    - VF_sealed
             |    v
        .----+--------.              .-------------------.
        |             |-------------&gt;|   AS-B (OAuth)    |
        |   Client    | 4. Present   |   Token Issuer    |
        | (Attester)  |    AR grant  '---+------+--------'
        |             |&lt;-|               |      ^
        '------+------.  +---------------+      |
               |                     5. Validate AR
               | 6. Present token       Issue access token
               |    + DPoP proof                |
               |    (signed with K_dpop_priv)   |
               v                                |
        .------+-------.              7. Validate token cnf
        |  RS-B        +------------&gt;    DPoP signature
        | (Resource    |                 with K_dpop_pub
        |  Server)     |
        '--------------'
</pre><a href="#section-2-5" class="pilcrow">¶</a>
</div>
<p id="section-2-6">Figure 1: OAuth Identity Chaining Flow with RATS Verifier as AS-A and "IDPoP"-aware OAuth AS-B as delegated notary<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7"><em>NOTE: K_kem controls access to VF (identity key seed material). K_attest <strong>is</strong> the identity. Compromise of the identity key alone is insufficient—attacker needs to demonstrate access to notorized Evidence (EF) to derive K_kem and unseal.</em><a href="#section-2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="algorithms">
<section id="section-3">
      <h2 id="name-algorithms">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-algorithms" class="section-name selfRef">Algorithms</a>
      </h2>
<div id="algorithm-1-derivekem-client">
<section id="section-3.1">
        <h3 id="name-algorithm-1-derivekem-clien">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-algorithm-1-derivekem-clien" class="section-name selfRef">Algorithm 1: DeriveKEM (Client)</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-3.1-1">
<pre>
Input:  PF, EF
Output: (K_kem_priv, K_kem_pub)

K_kem_priv = HKDF(salt=PF, ikm=EF, info="seal")
K_kem_pub  = X25519.Public(K_kem_priv)
</pre><a href="#section-3.1-1" class="pilcrow">¶</a>
</div>
<div id="algorithm-2-encapsulatesecret-as-a">
<section id="section-3.1.1">
          <h4 id="name-algorithm-2-encapsulatesecr">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-algorithm-2-encapsulatesecr" class="section-name selfRef">Algorithm 2: EncapsulateSecret (AS-A)</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.1.1-1">
<pre>
Input:  PF, K_kem_pub (from client attestation)
Output: (VF_sealed, K_dpop_pub)

VF = Random(32)
VF_sealed = HPKE.Seal(recipient_pk=K_kem_pub, info=PF, plaintext=VF)

K_dpop_priv = HKDF(salt=PF, ikm=VF, info="dpop")
K_dpop_pub  = Ed25519.Public(K_dpop_priv)
</pre><a href="#section-3.1.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="algorithm-3-deriveidentity-client">
<section id="section-3.1.2">
          <h4 id="name-algorithm-3-deriveidentity-">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-algorithm-3-deriveidentity-" class="section-name selfRef">Algorithm 3: DeriveIdentity (Client)</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-3.1.2-1">
<pre>
Input:  PF, K_kem_priv, VF_sealed
Output: K_dpop_priv

VF = HPKE.Unseal(recipient_sk=K_kem_priv, info=PF, ciphertext=VF_sealed)
K_dpop_priv = HKDF(salt=PF, ikm=VF, info="dpop")
</pre><a href="#section-3.1.2-1" class="pilcrow">¶</a>
</div>
<p id="section-3.1.2-2"><strong>Convergence:</strong> Client derives K_dpop_priv from (PF, VF) only after unsealing the encapsulated VF secret.<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="oauth-identity-chaining-flow">
<section id="section-4">
      <h2 id="name-oauth-identity-chaining-flo">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-oauth-identity-chaining-flo" class="section-name selfRef">OAuth Identity Chaining Flow</a>
      </h2>
<p id="section-4-1"><strong>Setup (Client → AS-A):</strong><a href="#section-4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2">
<li id="section-4-2.1">
          <p id="section-4-2.1.1">Client generates attestation evidence (EF)<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-2.2">
          <p id="section-4-2.2.1">Client: <code>K_kem_priv = DeriveKEM(PF, EF)</code><a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-2.3">
          <p id="section-4-2.3.1">Client sends attestation to AS-A with <code>K_kem_pub</code><a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-4-3"><strong>Notarization (RATS Verifier as AS-A):</strong><a href="#section-4-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-4">
<li id="section-4-4.1">
          <p id="section-4-4.1.1">AS-A Appraises attestation Evidence<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-4.2">
          <p id="section-4-4.2.1">AS-A: <code>(VF_sealed, K_dpop_pub) = EncapsulateSeed(PF, K_kem_pub)</code><a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-4.3">
          <p id="section-4-4.3.1">AS-A creates JWT grant to AS-B:<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div class="lang-json sourcecode" id="section-4-5">
<pre>
   {
     "iss": "https://as-a.example",
     "sub": "client_id",
     "aud": "https://as-b.example",
     "iat": 1706745600,
     "exp": 1706745660,
     "jti": "grant-7f3a9c",
     "requested_cnf": {
       "jkt": "0ZcOCORZNYy-DWpqq30jZyJGHTN0d2HglBV3uiguA4I",
       "K_kem_pub": {
         "kty": "OKP",
         "crv": "X25519",
         "x": "l8tFrhx-34tV3hRICRDY9zCkDlpBhF42UQUfWVAWBFs"
       }
     }
   }
</pre><a href="#section-4-5" class="pilcrow">¶</a>
</div>
<p id="section-4-6"><strong>Token Issuance (AS-B):</strong><a href="#section-4-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-7">
<li id="section-4-7.1">
          <p id="section-4-7.1.1">AS-B validates grant, issues DPoP-bound access token:<a href="#section-4-7.1.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div class="lang-json sourcecode" id="section-4-8">
<pre>
   {
     "access_token": "eyJ...(JWT with cnf.jkt inside)...",
     "token_type": "DPoP",
     "expires_in": 3600
   }
</pre><a href="#section-4-8" class="pilcrow">¶</a>
</div>
<p id="section-4-9">The access token JWT contains:<a href="#section-4-9" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4-10">
<pre>
   {
     "iss": "https://as-b.example",
     "sub": "client_id",
     "aud": "https://rs-b.example",
     "iat": 1706745600,
     "exp": 1706749200,
     "cnf": {
       "jkt": "0ZcOCORZNYy-DWpqq30jZyJGHTN0d2HglBV3uiguA4I", // Validates the DPoP signature (Standard)
       "K_kem_pub": { // Enables the Liveness Challenge (IDPoP Extension)
         "kty": "OKP",
         "crv": "X25519",
         "x": "l8tFrhx-34tV3hRICRDY9zCkDlpBhF42UQUfWVAWBFs"
       }
     }
   }
</pre><a href="#section-4-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="interactive-challenge-proofs">
<section id="section-5">
      <h2 id="name-interactive-challenge-proof">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-interactive-challenge-proof" class="section-name selfRef">Interactive Challenge &amp; Proofs</a>
      </h2>
<p id="section-5-1"><strong>Interactive Challenge (AS-B → Client):</strong><a href="#section-5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-2">
<li id="section-5-2.1">
          <p id="section-5-2.1.1">Client sends request with DPoP proof (no nonce or cached nonce)<a href="#section-5-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-2.2">
          <p id="section-5-2.2.1">AS-B decides: "I need hardware liveness proof"<a href="#section-5-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-2.3">
          <p id="section-5-2.3.1">AS-B → 401 Unauthorized<a href="#section-5-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div class="alignLeft art-text artwork" id="section-5-3">
<pre>
    WWW-Authenticate: DPoP error="use_dpop_nonce"
    DPoP-Nonce: &lt;Base64Url(HPKE.AuthSeal(nonce, K_kem_pub, AS_B_privkey))&gt;
</pre><a href="#section-5-3" class="pilcrow">¶</a>
</div>
<p id="section-5-4"><strong>Client Proof:</strong><a href="#section-5-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-5">
<li id="section-5-5.1">
          <p id="section-5-5.1.1"><code>VF = HPKE.Unseal(K_kem_priv, VF_sealed)</code> [proves fresh EF]<a href="#section-5-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-5.2">
          <p id="section-5-5.2.1">Client extracts sealed nonce from header<a href="#section-5-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-5.3">
          <p id="section-5-5.3.1">Client: nonce = HPKE.AuthUnseal(nonce_sealed, K_kem_priv, AS_B_pubkey)<a href="#section-5-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-5.4">
          <p id="section-5-5.4.1">Client: <code>K_dpop_priv = HKDF(PF, VF, "dpop")</code><a href="#section-5-5.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-5.5">
          <p id="section-5-5.5.1">Client creates new DPoP proof with unsealed nonce and retries:<a href="#section-5-5.5.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div class="lang-json sourcecode" id="section-5-6">
<pre>
    {
      "typ": "idpop+jwt", // Proposed new type
      "alg": "EdDSA",
      "jwk": { // The Public Identity Key (K_dpop)
        "kty": "OKP",
        "crv": "Ed25519",
        "x": "11qYAYKxCrfVS_7TyWQHOg7hcvPapiMlrwIaaPcHURo"
      }
    }
    {
      "jti": "e1j3V_bKic8-LAEB",
      "htm": "POST",
      "htu": "https://rs-b.example/api",
      "iat": 1706745600,
      "ath": "fUHyO2r2Z3DZ53EsNrWBb0xWXoaNy59IiKCAqksmQEo",
      "nonce": "kH8Ws3xYnE2f7d9pQ1vR5jL4mT6oU0aC8bN3gZ7yXsA"
    }
</pre><a href="#section-5-6" class="pilcrow">¶</a>
</div>
<p id="section-5-7"><strong>Verification (AS-B or RS-B):</strong><a href="#section-5-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-8">
<li id="section-5-8.1">
          <p id="section-5-8.1.1">Verify DPoP signature with K_dpop_pub (from token's <code>cnf.jkt</code>)<a href="#section-5-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-8.2">
          <p id="section-5-8.2.1">Verify <code>proof.nonce == SHA256(expected_nonce)</code><a href="#section-5-8.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-8.3">
          <p id="section-5-8.3.1">Accept request<a href="#section-5-8.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-5-9"><em>Note: The interactive challenge (Steps 8-10) introduces a round-trip. To mitigate latency, this challenge MAY be performed once per session or upon detecting high-risk context. The resulting <code>nonce</code> acts as a session binding signal for subsequent DPoP proofs, reducing overhead for high-frequency API calls.</em><a href="#section-5-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-properties">
<section id="section-6">
      <h2 id="name-security-properties">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-properties" class="section-name selfRef">Security Properties</a>
      </h2>
<ol start="1" type="1" class="normal type-1" id="section-6-1">
<li id="section-6-1.1">
          <p id="section-6-1.1.1"><strong>No durable secrets at AS-A.</strong> Post-issuance compromise of AS-A yields no client key material. RATS Verifier (AS-A) computes <code>K_dpop_priv</code> transiently, extracts <code>K_dpop_pub</code>, discards both <code>K_dpop_priv</code> and secret seed material (<code>VF</code>).<a href="#section-6-1.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-1.2">
          <p id="section-6-1.2.1"><strong>Sealed grant confidentiality.</strong> Interception without <code>K_kem_priv</code> yields nothing. <code>VF_sealed</code> is HPKE-encrypted to <code>K_kem_pub</code>.<a href="#section-6-1.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-1.3">
          <p id="section-6-1.3.1"><strong>Attestation-bound unsealing.</strong> Stolen <code>VF_sealed</code> without device access is unusable. <code>K_kem_priv = HKDF(PF, EF)</code>. Unsealing <code>VF</code> requires fresh hardware attestation.<a href="#section-6-1.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-1.4">
          <p id="section-6-1.4.1"><strong>Key separation.</strong> <code>K_kem</code> controls access. <code>K_dpop</code> asserts identity. Compromise of signing key doesn't grant unsealing; compromise of unsealing requires live <code>EF</code>.<a href="#section-6-1.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-1.5">
          <p id="section-6-1.5.1"><strong>Convergent derivation.</strong> No key transport. Client derives <code>K_dpop</code> from (PF, VF) independently.<a href="#section-6-1.5.1" class="pilcrow">¶</a></p>
</li>
      </ol>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="authorization-server-as-root-of-trust">
<section id="section-7.1">
        <h3 id="name-authorization-server-as-roo">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-authorization-server-as-roo" class="section-name selfRef">Authorization Server as Root of Trust</a>
        </h3>
<p id="section-7.1-1">The architecture described in this document leverages the Authorization Server (AS-A in the RATS flow, or the OAuth AS) as a Trusted Third Party (TTP). This aligns with the standard OAuth 2.0 threat model <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span>, where the AS is already trusted to generate access tokens, sign ID tokens, and manage client credentials.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">While IDPoP introduces the generation and sealing of the Identity Key seed (VF) by the AS, this does not introduce a new root of trust. An AS capable of issuing a valid <code>access_token</code> can already impersonate the user to the Resource Server. Therefore, entrusting the AS with the transient generation of the VF seed is consistent with its existing role. The security goal of IDPoP is not to protect the client <em>from</em> the AS, but to protect the client's credentials from exfiltration <em>after</em> issuance.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encapsulated-secret-transport">
<section id="section-7.2">
        <h3 id="name-encapsulated-secret-transpo">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-encapsulated-secret-transpo" class="section-name selfRef">Encapsulated Secret Transport</a>
        </h3>
<p id="section-7.2-1">This specification utilizes a Key Transport pattern where the Identity Key material (VF) is generated by the server and transmitted to the client in an HPKE-sealed envelope (VF_sealed). While Key Transport is sometimes disfavored in comparison to Key Agreement, it is necessary here to bind the identity to the specific hardware attestation presented by the client.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">The security of this transport relies on <strong>Hardware Binding</strong>: The VF is sealed to <code>K_kem_pub</code>, which is derived from the client's hardware-bound Evidence Factor (EF). Even if <code>VF_sealed</code> is intercepted, it remains "inert" (unusable) without the corresponding hardware-bound private key <code>K_kem_priv</code>.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="harvest-now-decrypt-later-and-forward-secrecy">
<section id="section-7.3">
        <h3 id="name-harvest-now-decrypt-later-a">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-harvest-now-decrypt-later-a" class="section-name selfRef">"Harvest Now, Decrypt Later" and Forward Secrecy</a>
        </h3>
<p id="section-7.3-1">A prominent concern with any encrypted transport of secrets is the "Harvest Now, Decrypt Later" (HNDL) strategy, where an adversary records encrypted traffic today to decrypt it in the future once quantum computing breaks current asymmetric primitives (e.g., X25519).<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">In the context of IDPoP, the impact of HNDL is significantly mitigated by the <strong>ephemeral nature of the Identity Key</strong>:<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-3.1">
            <p id="section-7.3-3.1.1"><strong>Short-Lived Credential Utility:</strong> The VF seed is used solely to derive the DPoP signing key (<code>K_dpop</code>). This key is only useful for signing DPoP proofs for the validity period of the associated access token (defined by <code>exp</code>).<a href="#section-7.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-3.2">
            <p id="section-7.3-3.2.1"><strong>Obsolescence upon Decryption:</strong> If an adversary successfully breaks the KEM algorithm years in the future and recovers a historical <code>VF</code>, the associated access token will have long since expired. Unlike confidentiality keys used to encrypt persistent data (where future decryption is catastrophic), recovering an authentication key after the session window has closed yields no advantage, provided the AS enforces standard expiration (<code>exp</code>) and replay protection (<code>jti</code>).<a href="#section-7.3-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="post-quantum-agility">
<section id="section-7.3.1">
          <h4 id="name-post-quantum-agility">
<a href="#section-7.3.1" class="section-number selfRef">7.3.1. </a><a href="#name-post-quantum-agility" class="section-name selfRef">Post-Quantum Agility</a>
          </h4>
<p id="section-7.3.1-1">To further mitigate HNDL risks and ensure long-term resistance, implementations SHOULD support cryptographic agility in the HPKE configuration.<a href="#section-7.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3.1-2.1">
              <p id="section-7.3.1-2.1.1"><strong>Hybrid KEMs:</strong> Implementations can adopt hybrid KEMs such as <strong>X-Wing</strong> (combining X25519 and ML-KEM-768) to provide post-quantum resistance while maintaining classical security guarantees.<a href="#section-7.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.3.1-2.2">
              <p id="section-7.3.1-2.2.1"><strong>Algorithm Negotiation:</strong> The <code>alg</code> parameter in the attestation request or metadata allows the client and AS to negotiate Quantum-Resistant KEMs (e.g., ML-KEM) as they become standardized, ensuring the VF_sealed remains secure against future quantum cryptanalysis.<a href="#section-7.3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="dpop-proof-replay-and-pre-computation">
<section id="section-7.4">
        <h3 id="name-dpop-proof-replay-and-pre-c">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-dpop-proof-replay-and-pre-c" class="section-name selfRef">DPoP Proof Replay and Pre-Computation</a>
        </h3>
<p id="section-7.4-1">To prevent an attacker with temporary access to the signing key (or the ability to predict nonces) from pre-computing proofs, this specification mandates the use of HPKE-sealed nonces.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4-2.1">
            <p id="section-7.4-2.1.1"><strong>Liveness Requirement:</strong> By sealing the nonce to the client's <code>K_kem_pub</code>, the AS ensures that only a client with active access to the hardware-bound <code>K_kem_priv</code> can recover the nonce and sign the proof.<a href="#section-7.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.4-2.2">
            <p id="section-7.4-2.2.1"><strong>Mitigation of Malware:</strong> Malware capable of stealing a cached <code>K_dpop</code> from memory cannot pre-generate valid proofs for future requests because it cannot decrypt the future nonces without invoking the hardware anchor.<a href="#section-7.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-normative-references">
<section id="section-8">
      <h2 id="name-normative-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-oauth-identity-chaining">[I-D.ietf-oauth-identity-chaining]</dt>
      <dd>
<span class="refAuthor">Schwenkschuster, A.</span>, <span class="refAuthor">Kasselman, P.</span>, <span class="refAuthor">Burgin, K.</span>, <span class="refAuthor">Jenkins, M. J.</span>, and <span class="refAuthor">B. Campbell</span>, <span class="refTitle">"OAuth Identity and Authorization Chaining Across Domains"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-oauth-identity-chaining-06</span>, <time datetime="2025-09-12" class="refDate">12 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-identity-chaining-06">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-identity-chaining-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6819">[RFC6819]</dt>
      <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">McGloin, M.</span>, and <span class="refAuthor">P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Threat Model and Security Considerations"</span>, <span class="seriesInfo">RFC 6819</span>, <span class="seriesInfo">DOI 10.17487/RFC6819</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6819">https://www.rfc-editor.org/rfc/rfc6819</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9449">[RFC9449]</dt>
    <dd>
<span class="refAuthor">Fett, D.</span>, <span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Jones, M.</span>, and <span class="refAuthor">D. Waite</span>, <span class="refTitle">"OAuth 2.0 Demonstrating Proof of Possession (DPoP)"</span>, <span class="seriesInfo">RFC 9449</span>, <span class="seriesInfo">DOI 10.17487/RFC9449</span>, <time datetime="2023-09" class="refDate">September 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9449">https://www.rfc-editor.org/rfc/rfc9449</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nathanael Ritz</span></div>
<div dir="auto" class="left"><span class="org">Independent</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@nritz.com" class="email">ietf@nritz.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
